{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center">Avaliações Realizadas</h2>

    <a href="{% url 'export_all_evaluations' %}" class="btn btn-primary mb-4 w-100"><i class="bi bi-download me-2"></i>Exportar Todas as Avaliações</a>

    <!-- Campo de pesquisa -->
    <div class="input-group mb-3">
        <input id="searchInput" class="form-control" type="text" placeholder="Pesquisar...">
        <button class="btn btn-outline-secondary" type="button"><i class="bi bi-search"></i></button>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover" id="evaluationTable">
            <thead class="thead-dark">
                <tr>
                    <th scope="col"><button class="btn btn-link text-decoration-none" onclick="sortTable(0)">Avaliador <i class="bi bi-arrow-down-up"></i></button></th>
                    <th scope="col"><button class="btn btn-link text-decoration-none" onclick="sortTable(1)">Avaliado <i class="bi bi-arrow-down-up"></i></button></th>
                    <th scope="col"><button class="btn btn-link text-decoration-none" onclick="sortTable(2)">Cliente <i class="bi bi-arrow-down-up"></i></button></th>
                    <th scope="col"><button class="btn btn-link text-decoration-none" onclick="sortTable(3)">Data <i class="bi bi-arrow-down-up"></i></button></th>
                    <th scope="col"><button class="btn btn-link text-decoration-none" onclick="sortTable(4)">Ações <i class="bi bi-arrow-down-up"></i></button></th>
                </tr>
            </thead>
            <tbody id="tableBody">
                {% for evaluation in evaluations %}
                <tr>
                    <td>{{ evaluation.schedule.evaluator.first_name }} {{evaluation.schedule.evaluator.last_name }}</td>
                    <td>{{evaluation.schedule.evaluatee.first_name }} {{evaluation.schedule.evaluatee.last_name }}</td>
                    <td>{{ evaluation.schedule.client.name }}</td>
                    <td>{{ evaluation.date_completed|date:"d/m/Y" }}</td>
                    <td>
                        <a href="{% url 'evaluation_detail' evaluation.id %}" class="btn btn-outline-info btn-sm">Detalhes</a>
                        <a href="{% url 'export_evaluation' evaluation.id %}" class="btn btn-outline-success btn-sm">Baixar</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Paginação -->
    {% comment %} <div class="d-flex justify-content-end">
        <nav aria-label="Table navigation">
            <ul class="pagination mb-0">
                <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Anterior</a>
                </li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#">Proximo</a>
                </li>
            </ul>
        </nav>
    </div> {% endcomment %}
</div>

<style>
    /* Estilos gerais para a tabela */
table {
    width: 100%; /* Define que a tabela ocupe 100% do espaço disponível */
    border-collapse: collapse; /* Remove espaçamentos entre células */
    margin: 20px 0; /* Define espaçamento entre a tabela e outros elementos */
    font-size: 16px; /* Define o tamanho da fonte */
    font-family: 'Arial', sans-serif; /* Define a fonte */
    background-color: var(--card-bg); /* Cor de fundo da tabela conforme o tema */
    color: var(--text-color); /* Cor do texto conforme o tema */
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Sombra para destacar a tabela */
    border: 1px solid var(--text-color); /* Borda leve conforme o tema */
}

/* Estilo para cabeçalhos da tabela */
th {
    background-color: #007bff; /* Cor de fundo do cabeçalho */
    color: white; /* Cor do texto no cabeçalho */
    text-align: left; /* Alinhamento do texto no cabeçalho */
    padding: 12px 15px; /* Espaçamento interno */
    border-bottom: 2px solid #dee2e6; /* Borda inferior */
}

/* Estilo para células de dados */
td {
    padding: 12px 15px; /* Espaçamento interno */
    border-bottom: 1px solid var(--text-color); /* Borda conforme o tema */
    color: var(--text-color); /* Cor do texto conforme o tema */
}

/* Alternar cores nas linhas para melhor visualização no modo claro */
.light-theme tr:nth-child(even) {
    background-color: #f2f2f2; /* Cor para linhas pares */
}

/* Alternar cores nas linhas para melhor visualização no modo escuro */
.dark-theme tr:nth-child(even) {
    background-color: #444; /* Cor para linhas pares no tema escuro */
}

/* Efeito de hover nas linhas */
tr:hover {
    background-color: var(--sidebar-bg); /* Cor de fundo ao passar o mouse conforme o tema */
    transition: background-color 0.3s ease; /* Suavização da transição */
}

/* Ajuste para tabelas responsivas */
@media (max-width: 768px) {
    table, thead, tbody, th, td, tr {
      display: block;
    }
    tr {
      margin-bottom: 15px;
    }
    td {
      text-align: right;
      padding-left: 50%;
      position: relative;
    }
    td::before {
      content: attr(data-label); /* Adiciona o título da coluna antes do valor */
      position: absolute;
      left: 0;
      width: 50%;
      padding-left: 15px;
      font-weight: bold;
      text-align: left;
    }
}

</style>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function(){
        $("#searchInput").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            $("#tableBody tr").filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });

    function sortTable(n) {
        var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
        table = document.getElementById("evaluationTable");
        switching = true;
        dir = "asc"; 
        while (switching) {
            switching = false;
            rows = table.rows;
            for (i = 1; i < (rows.length - 1); i++) {
                shouldSwitch = false;
                x = rows[i].getElementsByTagName("TD")[n];
                y = rows[i + 1].getElementsByTagName("TD")[n];
                if (dir == "asc") {
                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                } else if (dir == "desc") {
                    if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                }
            }
            if (shouldSwitch) {
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                switchcount ++;
            } else {
                if (switchcount == 0 && dir == "asc") {
                    dir = "desc";
                    switching = true;
                }
            }
        }
    }
</script>
{% endblock %}
